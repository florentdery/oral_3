---
title: "Les vaches,<br>les amphibiens<br>et vous"
author: "Équipe 5 - Florent Déry, Morgane Le Goff, Myriam Trottier-Paquet"
date: "`r Sys.Date()`"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
editor_options: 
  chunk_output_type: console
---

## Contexte

Choix de projet = Effets des pâturages sur l'abondance et la diversité des amphibiens.

Invertebrés vs sensibilité / eutrophisation
Écrevisses vs sensibilité / eutrophisation
Poisson ?? 

## Objectif et question de recherche (étape 1)

Vérifier l'impact du pâturage par le bétail (vaches) sur les communautés d'amphibiens. 





## Hypothèses et prédictions (étape 2) | sous-titre
### sous titre ???

La présence et l'intensité d'M'utilisation du bétail modifient les conditions physico-chimiques des étangs, et ainsi l'abondance des invertébrés, poissons et écrevisses, ce qui détermine la composition des communautés amphibiennes. 


Prédictions: 
- Les conditions physico-chimiques sont différentes entre les étangs cloturés vs non-cloturés. 
  - Les vaches seront corrélées positivement aux nitrites
  - Les vaches seront corrélées positivement à la *temperature*?
  - Les vaches seront corrélées positivement à la conductivité
  - Les vaches seront corrélées négativement au pH
  - Les vaches seront corrélées négativement à l'O^2

## Variables du système (étape 3)

- Modèle conceptuel?
Voici le jeu de données : 

```{r load_data, echo=F, warnings=F, message=F}
require(tidyverse)
dat=read.delim("data/jeu_ecologique.txt") %>% 
  mutate(etang=as.factor(as.character(etang)),
         cloture=factor(cloture)) %>% 
  rename(vache_std=vache) %>% 
  arrange(aire) 
glimpse(dat)
summary(dat)

```


```{r quick_look, echo=F, warnings=F, message=F}
dat %>% count(cloture)
length(unique(dat$etang))

dat %>% 
  select(A_Gr:N_Vi) %>% 
  colSums()

dat %>% select(invertebres:poissons) %>% 
  colSums()

require(ggplot)
ggplot(dat) +
  geom_histogram(aes(vache_std), alpha=.5)+
  facet_wrap(~cloture)

ggplot(dat, aes(poissons, fill=cloture)) +
  geom_boxplot( alpha=.5) 

ggplot(dat, aes(invertebres, fill=cloture)) +
  geom_boxplot( alpha=.5) 

ggplot(dat, aes(ecrevisses, fill=cloture)) +
  geom_boxplot( alpha=.5) 



dat[dat$cloture=="Yes",]$vache_std
dat[dat$cloture=="No",]$vache_std %>% sort()

```


## Rôle, type et distribution des variables (étape 4)
Myriam
- Y = matrice des communautés
- x= vache pas vache et intensité des vaches
- co-variables 
  - physico-chimie
  - caractéristiques physisiques de l'étang
    - aire, profondeur etc.
  - abondance des facteurs biotiques (invertébrés, ecrevisses et poissons)

## Interactions potentielles à tester (étape 5)

Les caractéristiques topographiques des étangs telles que la profondeur et la superficie pourraient être relié à l'état d'eutrophisation du plan d'eau, et ainsi avoir un impact sur l'abondance d'invertébrés, de poissons et d'écrevisses pour déterminer la composition communautés d'amphibiens. 

La profondeur et la supercie pourraient aussi interagir avec l'intensité d'utilisation par les vaches. Effectivement, pour une même intensité d'utilisation par les vaches, un petit lac peu profond recevra d'avantage d'intrants (phosphore, matière organique, nitrites etc.) qu'un étang plus grand et plus profond

Mais ces  caractéristiques pourraient aussi être des covariables (on est pas intéressé à ces variables, et il est peu probable d'avoir de sinteractions valables (p.ex. un petit étang risque dM'avoir toujours moins d'oxyugène etc. )) -> partial rda ? 

```{r, echo = TRUE}

dat %>% 
  mutate(prof_cat=factor(
    case_when(
      profondeur < 181 ~ "very_shallow", 
      profondeur %in% c(181:242)~ "shallow",
      profondeur %in% c(243:330)~ "medium",
      profondeur %in% c(331:460)~ "deep",
      profondeur > 460 ~ "very_deep"    
    ), levels= c("very_shallow", 
                 "shallow",
                 "medium",
                 "deep",
                 "very_deep")))%>% 
  pivot_longer(A_Gr:N_Vi, names_to = "espece", values_to = "prop") %>% 
  pivot_longer(conductivite:pH, names_to = "parametre", values_to = "mesure") %>% 
  ggplot()+
  geom_point(aes(x= mesure, y= prop, color=espece)) +
  facet_grid(vars(cloture), vars(prof_cat), scales= "free_x", space="free_x")+
  ylab("Proportion par site")+
  xlab("Mesure du paramètre")





```

## Exploration des données (étape 6)

Morgane : 6.1 à 6.4
Florent:6.5 à 6.8 

## 6.5 - Collinéarité des X
Premièrement avec les étangs non cloturés: 
```{r, echo=F, message=F, warnings=F, fig.width=10, fig.height=5.3}
dat %>% 
  subset(cloture=="No" & vache_std>0) %>% 
  select(vache_std:poissons) %>%
  relocate(aire, .after = profondeur) %>% 
  psych::pairs.panels()

```

## 6.5 - Collinéarité des X
Maintenant avec les étangs non cloturés, sans la variables vache
```{r, echo=F, message=F, warnings=F, fig.width=10, fig.height=5.3}
dat %>% 
    subset(cloture=="Yes" | vache_std==0) %>% 
  select(profondeur:poissons) %>%
  relocate(aire, .after = profondeur) %>% 
  psych::pairs.panels()

dat %>% 
    # subset(cloture=="Yes" | vache_std==0) %>% 
  select(vache_std:poissons) %>%
  relocate(aire, .after = profondeur) %>% 
  psych::pairs.panels()

```


## 6.5 - Collinéarité des X
Variable cloture vs. variables *physico-chimiques*

```{r, echo=F, message=F, warnings=F, fig.width=7, fig.height=4.3, fig.align="center"}
dat %>% 
  select(cloture, conductivite:pH) %>% 
  pivot_longer(conductivite:pH, names_to = "parametre", values_to = "mesure") %>% 
  ggplot(aes(y= mesure, x=cloture )) +
  geom_boxplot(outlier.shape = NA)+
  geom_jitter(height=0, width=.1)+
  facet_wrap(~parametre, scales = "free_y")+
  theme_bw()

```

## 6.5 - Collinéarité des X
Variable cloture vs. variables *topographiques*

```{r, echo=F, message=F, warnings=F, fig.width=7, fig.height=4.3, fig.align="center"}
dat %>% 
  select(cloture, profondeur, aire) %>% 
  pivot_longer(profondeur:aire, names_to = "caracteristique", values_to = "mesure") %>% 
  ggplot(aes(y= mesure, x=cloture )) +
  geom_boxplot(outlier.shape = NA)+
  geom_jitter(height=0, width=.1)+
  facet_wrap(~caracteristique, scales = "free_y")+
  theme_bw()

```

## 6.5 - Collinéarité des X
Variable cloture vs. variables *biotiques*

```{r, echo=F, message=F, warnings=F, fig.width=7, fig.height=4.3, fig.align="center"}
dat %>% 
  select(cloture, invertebres:poissons) %>% 
  pivot_longer(invertebres:poissons, names_to = "taxon", values_to = "compte") %>% 
  ggplot(aes(y= compte, x=cloture )) +
  geom_boxplot(outlier.shape = NA)+
  geom_jitter(height=0, width=.1)+
  facet_wrap(~taxon, scales = "free_y")+
  theme_bw()



```

## 6.6 Liens X et Y
Abondances relatives en fonction des paramètres physico-chimiques
```{r, echo=F, message=F, warnings=F, fig.width=7, fig.height=4.3, fig.align="center"}

pal=paletteer::paletteer_d("colorBlindness::paletteMartin") %>%  sample(9)

dat%>% 
  pivot_longer(A_Gr:N_Vi, names_to = "espece", values_to = "prop") %>% 
  pivot_longer(conductivite:pH, names_to = "parametre", values_to = "mesure") %>% 
  ggplot(aes(x= mesure, y= prop))+
  geom_point(aes(color=espece), size=2) +
    geom_smooth()+
   scale_color_manual(values=pal)+
 facet_wrap(~parametre, scales= "free_x")+
  ylab("Proportion par site")+
  xlab("Mesure du paramètre")+
  theme_bw()


 # %>% 
 #  mutate(prof_cat=factor(
 #    case_when(
 #      profondeur < 181 ~ "very_shallow", 
 #      profondeur %in% c(181:242)~ "shallow",
 #      profondeur %in% c(243:330)~ "medium",
 #      profondeur %in% c(331:460)~ "deep",
 #      profondeur > 460 ~ "very_deep"    
 #    ), levels= c("very_shallow", 
 #                 "shallow",
 #                 "medium",
 #                 "deep",
 #                 "very_deep")))
```

## 6.6 Liens X et Y
Abondances relatives en fonction des caractéristiques topographiques

```{r, echo=F, message=F, warnings=F, fig.width=7, fig.height=4.3, fig.align="center"}

dat%>% 
  pivot_longer(A_Gr:N_Vi, names_to = "espece", values_to = "prop") %>% 
  select(prop, profondeur, aire, espece) %>% 
  pivot_longer(profondeur:aire, names_to = "caracteristique", values_to = "mesure") %>% 
  ggplot(aes(x= mesure, y= prop))+
  geom_point(aes(color=espece), size=2) +
    geom_smooth()+
   scale_color_manual(values=pal)+
 facet_wrap(~caracteristique, scales= "free_x")+
  ylab("Proportion par site")+
  xlab("Mesure du paramètre")+
  theme_bw()

```

## 6.6 Liens X et Y
Abondances relatives en fonction des facteurs biotiques

```{r, echo=F, message=F, warnings=F, fig.width=10, fig.height=4.3, fig.align="center"}
dat%>% 
  pivot_longer(A_Gr:N_Vi, names_to = "espece", values_to = "prop") %>% 
  pivot_longer(invertebres:poissons, names_to = "facteur_biotique", values_to = "compte") %>% 
  ggplot(aes(x= compte, y= prop))+
  geom_point(aes(color=espece), size=2) +
    geom_smooth()+
   scale_color_manual(values=pal)+
 facet_wrap(~facteur_biotique, scales= "free_x")+
  ylab("Proportion par site")+
  xlab("Mesure du paramètre")+
  theme_bw()

```

## 6.6 Liens X et Y
Abondances relatives en fonction de l'intensité des vaches et de la présence de cloture


```{r, echo=F, message=F, warnings=F, fig.width=10, fig.height=4.3, fig.align="center"}
p1=dat%>% 
  pivot_longer(A_Gr:N_Vi, names_to = "espece", values_to = "prop") %>% 
  ggplot(aes(x= cloture, y= prop))+
  geom_boxplot(outlier.shape = NA)+
  geom_jitter(aes(color=espece),height=0, width=.1)+
   scale_color_manual(values=pal)+
  ylab("Proportion par site")+
  xlab("Cloturé?")+
  theme_bw()+
  theme(legend.position = "none")

p2= dat%>% 
  pivot_longer(A_Gr:N_Vi, names_to = "espece", values_to = "prop") %>% 
  ggplot(aes(x= vache_std, y= prop))+
  geom_point(aes(color=espece), size=2) +
    geom_smooth()+
   scale_color_manual(values=pal)+
  ylab("Proportion par site")+
  xlab("Intensité d'utilisation par les vaches")+
  theme_bw()

require(patchwork)
p1+p2+plot_layout(ncol=2, guides = "collect")

```

## 6.7 Indépendance des Y

Richesse spécifique nombre d'espèces en fonction des sites
```{r}
dat2=dat

rownames(dat2) <- dat2$etang

dat2=dat2 %>%
  arrange(etang) %>% 
  select(A_Gr:N_Vi)

dat2 %>% range()

sum(dat2==0) #254 absences 
sum(dat2>0) #106 presences
sum(dat2==0)/(nrow(dat2)*ncol(dat2))# 70% zeros

#number of sites with occurences of a given species 
spe.pres <- apply(dat2 > 0, 2, sum)
# Sort the results in increasing order
sort(spe.pres)

spe.relf <- 100*spe.pres/nrow(dat2)
# Round the sorted output to 1 digit
round(sort(spe.relf), 1)


par(mfrow=c(1,2))


# 3 espèces sont présentes dans 0 à 5 sites
hist(spe.pres, main="Species Occurrences", right=FALSE, las=1, 
    xlab="Number of occurrences", ylab="Number of species", 
    breaks=seq(0,30,by=5), col="bisque") 
# 3 espèces sont présentes dans 0 à 5 sites ^^ (p. ex)
hist(spe.relf, main="Species Relative Frequencies", right=FALSE, las=1,
    xlab="Frequency of occurrences (%)", ylab="Number of species",
        breaks=seq(0, 100, by=5), col="bisque")

# To sum by rows, the second argument of apply(), MARGIN, is set to 1
sit.pres <- apply(dat2> 0, 1, sum)
# Sort the results in increasing order
sort(sit.pres)

# Plot species richness vs. position of the sites along the river
plot(sit.pres,type="s", las=1, col="gray",
    main="Species richness across sites",
    xlab="site number", ylab="Species richness")
text(jitter(sit.pres, factor=1, amount=.1), row.names(dat2), cex=.8, col="red")


```


## 6.8 Collinéarité des Y


```{r, echo=F, message=F, warnings=F, fig.width=10, fig.height=4.3, fig.align="center"}
dat%>% 
  select(A_Gr:N_Vi) %>% 
  psych::pairs.panels()
```


## Choix de l'analyse (étape 7)

## Exécuter l'analyse (étape 8)
```{r}

```

## Choix de l'analyse (étape 7)

## Exécuter l'analyse (étape 8)